---
title: "LULC"
author: "Cameryn Brock"
date: "5/31/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

```{r}
library(foreign) # reading dbfs
library(ggmap) # base layer
library(sf) # shapefiles
library(raster) # raster
library(rasterVis) # raster
library(rgeos) # raster to polygons
library(janitor) 
library(here)
library(tidyverse)
```


# LULC for 2019
```{r}
lulc_raster_raw <- raster(here("data", "lulc-2019", "LULC_2019tif.tif"))

lulc_raster <- aggregate(lulc_raster_raw, fact = 10)

lulc_df <- as.data.frame(lulc_raster, xy = TRUE) %>% 
  rename("value" = "LULC_2019tif")

dbf_2019 <- read.dbf(here("data", "lulc-2019", "LULC_2019tif.tif.vat.dbf"),
                as.is = FALSE) %>% 
  clean_names()

lulc <- inner_join(lulc_df, dbf_2019, 
                   by = "value") %>% 
  filter(class %in% c("Palm Plantation", "Pineapple", "Coffee", 
                      "Melina_Teak", "Primary Forest", "Secondary Forest"))

```

## ROI 
```{r}
# Create a polygon of the LULC boundaries
roi_extent <- as(extent(lulc_raster), ('SpatialPolygons'))

lulc_reclass <- reclassify(lulc_raster,
                                cbind(-Inf, Inf, 1))

roi_sp <- rasterToPolygons(lulc_reclass, dissolve = TRUE) 

roi <- st_as_sf(roi_sp)
```

## Cantons
```{r}
cantons_raw <- read_sf(dsn = here("data", "cantones-2014"), 
                   layer = "Cantones2014ctm05") %>% 
  clean_names() %>% 
  dplyr::select("ncanton", "nprovincia", "hectares") %>% 
  filter(ncanton %in% c("OSA", "GOLFITO", "COTO BRUS", 
                        "BUENOS AIRES", "TALAMANCA", "CORREDORES"))

## Crop to match amistosa corridor
st_crs(cantons_raw) <- 4326
st_crs(roi) <- 4326
cantons <- st_intersection(cantons_raw, roi)

plot(cantons)

```

## `ggmap`
```{r}
amistosa <- get_map(location = c(lon = -83.15,
                                   lat = 8.748),
                      zoom = 9,
                      maptype = "terrain-background",
                      source = "google")
```

## Map for Proposal

```{r}
ggplot() + 
  geom_sf(data = cantons,
          color = "black")
```


